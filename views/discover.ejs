<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover" />
    <title>Discover | Apugo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        body {
            background-color: #020617;
            font-family: 'Plus Jakarta Sans', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        .glass-nav {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
        }

        /* Modern Masonry */
        .masonry-grid {
            column-count: 1;
            column-gap: 1.25rem;
        }
        @media (min-width: 640px) { .masonry-grid { column-count: 2; } }
        @media (min-width: 1024px) { .masonry-grid { column-count: 3; } }

        .break-inside-avoid {
            break-inside: avoid;
            margin-bottom: 1.25rem;
        }

        /* Card Entrance Animation */
        .animate-card {
            opacity: 0;
            animation: cardReveal 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards;
        }

        @keyframes cardReveal {
            from { opacity: 0; transform: translateY(30px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* Glass Search */
        .search-container input {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: inset(10px);
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        ::-webkit-scrollbar { width: 0px; }
    </style>
</head>

<body class="text-slate-200 pb-40">

<nav class="glass-nav border-b border-white/5 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
        <h1 class="text-xl font-black text-blue-500 italic tracking-tighter cursor-pointer" onclick="location.href='/feed'">
            APUGO
        </h1>

        <div class="flex items-center gap-4">
            <div class="search-container relative hidden md:block">
                <form action="/discover" method="GET">
                    <input type="text" name="search" placeholder="Search the wilds..." 
                        class="rounded-2xl py-2 pl-10 pr-4 text-[10px] uppercase font-black focus:border-blue-500/50 outline-none w-64 transition-all text-white">
                    <i class="fas fa-search absolute left-4 top-3 text-slate-600 text-[10px]"></i>
                </form>
            </div>

            <a href="/logout" class="text-[9px] font-black text-slate-500 uppercase border border-white/5 px-4 py-2 rounded-full hover:bg-red-500/10 hover:text-red-500 transition-all">
                Exit
            </a>
        </div>
    </div>
</nav>

<div class="max-w-7xl mx-auto px-6">

    <header class="py-12 md:py-20 text-center md:text-left">
        <h1 class="text-6xl md:text-8xl font-black italic tracking-tighter text-white mb-4 leading-none">
            DISCOVER
        </h1>
        <div class="flex flex-col md:flex-row md:items-center gap-4">
            <div class="h-[2px] w-16 bg-blue-600 hidden md:block"></div>
            <p class="text-slate-500 text-[11px] uppercase tracking-[0.5em] font-black">
                Unearthing the village's deepest echoes
            </p>
        </div>
    </header>

    <div class="masonry-grid">

        <% if (posts && posts.length > 0) { %>
            <% posts.forEach((post, index) => { %>

                <article class="break-inside-avoid animate-card group" style="animation-delay:<%= index * 0.08 %>s">
                    <div class="bg-slate-900/40 border border-white/5 rounded-[2.5rem] overflow-hidden hover:border-blue-500/30 transition-all duration-500 shadow-2xl">
                        
                        <% if (post.image_url) { %>
                            <div class="relative aspect-auto overflow-hidden bg-slate-950">
                                <% if (post.media_type === 'video') { %>
                                    <video src="<%= post.image_url %>" muted loop playsinline
                                        class="w-full grayscale group-hover:grayscale-0 group-hover:scale-105 transition-all duration-1000"
                                        onmouseover="this.play()" onmouseout="this.pause()">
                                    </video>
                                    <div class="absolute top-6 right-6 bg-black/40 backdrop-blur-md w-9 h-9 rounded-full flex items-center justify-center border border-white/10">
                                        <i class="fas fa-play text-[8px] text-white/80"></i>
                                    </div>
                                <% } else { %>
                                    <img src="<%= post.image_url %>" loading="lazy"
                                        class="w-full grayscale group-hover:grayscale-0 group-hover:scale-110 transition-all duration-1000"/>
                                <% } %>
                                
                                <div class="absolute inset-0 bg-gradient-to-t from-slate-950 via-transparent to-transparent opacity-60 group-hover:opacity-20 transition-opacity"></div>
                            </div>
                        <% } %>

                        <div class="p-8">
                            <div class="flex justify-between items-start mb-6">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-[10px] font-black border border-white/10">
                                        <%= post.author[0].toUpperCase() %>
                                    </div>
                                    <div>
                                        <p class="text-xs font-black text-white uppercase tracking-tight">
                                            @<%= post.author.split('@')[0] %>
                                        </p>
                                        <p class="text-[8px] text-blue-500 font-black uppercase tracking-widest">Resident</p>
                                    </div>
                                </div>

                                <% if (user.id !== post.created_by) { %>
                                    <form action="/friends/request/<%= post.created_by %>" method="POST">
                                        <button class="bg-white/5 hover:bg-blue-600 text-white w-9 h-9 rounded-full flex items-center justify-center transition-all border border-white/5 active:scale-90">
                                            <i class="fas fa-plus text-[10px]"></i>
                                        </button>
                                    </form>
                                <% } %>
                            </div>

                            <p class="text-sm md:text-base text-slate-400 group-hover:text-slate-200 transition-colors italic leading-relaxed font-medium mb-6">
                                "<%= post.description %>"
                            </p>

                            <div class="flex items-center gap-6 pt-6 border-t border-white/5">
                                <div class="flex items-center gap-2 group/stat">
                                    <i class="fas fa-heart text-slate-700 group-hover/stat:text-red-500 transition-colors"></i>
                                    <span class="text-[10px] font-black text-slate-500 uppercase tracking-widest"><%= post.likes || 0 %></span>
                                </div>
                                <div class="flex items-center gap-2 group/stat">
                                    <i class="fas fa-comment text-slate-700 group-hover/stat:text-blue-500 transition-colors"></i>
                                    <span class="text-[10px] font-black text-slate-500 uppercase tracking-widest"><%= post.comments_count || 0 %></span>
                                </div>
                                <div class="ml-auto">
                                    <i class="fas fa-share-nodes text-slate-800 text-xs hover:text-white cursor-pointer transition-colors"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </article>

            <% }) %>
        <% } else { %>
            <div class="col-span-full py-40 text-center">
                <div class="w-24 h-24 bg-slate-900/50 rounded-full flex items-center justify-center mx-auto mb-6 border border-white/5">
                    <i class="fas fa-compass text-slate-800 text-4xl animate-pulse"></i>
                </div>
                <h3 class="text-slate-500 font-black uppercase tracking-[0.5em] text-xs">The Wilds are Quiet</h3>
                <p class="text-slate-700 text-[10px] font-black uppercase mt-2">No secrets have been unearthed today</p>
            </div>
        <% } %>

    </div>
</div>

<nav class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-slate-900/90 backdrop-blur-3xl border border-white/10 px-10 py-5 rounded-full flex gap-12 shadow-[0_20px_50px_rgba(0,0,0,0.5)] z-[60] md:bottom-12 transition-transform hover:scale-105">
    <a href="/feed" class="text-slate-500 hover:text-white transition-all"><i class="fas fa-home text-lg"></i></a>
    <a href="/discover" class="text-blue-500 scale-125 drop-shadow-[0_0_10px_#3b82f6]"><i class="fas fa-compass text-lg"></i></a>
    <a href="/messages" class="text-slate-500 hover:text-white transition-all"><i class="fas fa-comment-dots text-lg"></i></a>
    <a href="/profile" class="text-slate-500 hover:text-white transition-all"><i class="fas fa-user text-lg"></i></a>
</nav>

</body>
</html>