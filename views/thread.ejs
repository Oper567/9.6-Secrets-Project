<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title><%= thread.title %> | Town Hall</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body { 
            background: #020617; 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            color: #e2e8f0; 
            scroll-behavior: smooth;
        }
        .glass-nav { 
            background: rgba(2, 6, 23, 0.9); 
            backdrop-filter: blur(24px); 
            border-bottom: 1px solid rgba(255,255,255,0.03); 
        }
        .op-card { 
            background: linear-gradient(160deg, rgba(30, 41, 59, 0.5), rgba(15, 23, 42, 0.5)); 
            border: 1px solid rgba(59, 130, 246, 0.15); 
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        .reply-card { 
            background: rgba(30, 41, 59, 0.2); 
            border-left: 3px solid rgba(59, 130, 246, 0.3); 
            transition: transform 0.2s ease;
        }
        .reply-card:hover {
            background: rgba(30, 41, 59, 0.3);
            transform: translateX(4px);
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="min-h-screen pb-32">

    <nav class="glass-nav sticky top-0 z-50">
        <div class="max-w-4xl mx-auto px-6 py-4 flex items-center justify-between">
            <a href="/forum" class="group text-slate-400 hover:text-white text-[10px] font-black uppercase tracking-widest flex items-center gap-2 transition-all">
                <i class="fas fa-arrow-left group-hover:-translate-x-1 transition-transform"></i> 
                Back to Hall
            </a>
            <div class="flex items-center gap-3">
                <span class="px-3 py-1 bg-blue-500/10 border border-blue-500/20 rounded-full text-[9px] font-black text-blue-400 uppercase tracking-widest">
                    <%= thread.category %>
                </span>
            </div>
        </div>
    </nav>

    <main class="max-w-4xl mx-auto px-4 mt-8">
        
        <article class="op-card rounded-[3rem] p-8 md:p-10 mb-12">
            <header class="flex items-center justify-between mb-8">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 rounded-2xl overflow-hidden border-2 border-blue-500/20 shadow-lg shadow-blue-500/10">
                        <img src="<%= thread.author_pic || '/default-avatar.png' %>" class="w-full h-full object-cover">
                    </div>
                    <div>
                        <div class="flex items-center gap-2">
                            <p class="text-white font-extrabold text-base italic">@<%= thread.author_name %></p>
                            <% if (thread.is_verified) { %>
                                <i class="fas fa-certificate text-blue-500 text-[10px]"></i>
                            <% } %>
                        </div>
                        <p class="text-[9px] text-slate-500 font-black uppercase tracking-widest">
                            Chieftain of this Thread â€¢ <%= new Date(thread.created_at).toLocaleDateString() %>
                        </p>
                    </div>
                </div>
                
                <div class="hidden md:flex flex-col items-end">
                    <span class="text-[10px] font-black text-slate-600 uppercase tracking-tighter">Engagement</span>
                    <span class="text-blue-500 font-black text-xl"><%= replies.length %></span>
                </div>
            </header>

            <h2 class="text-3xl md:text-4xl font-black text-white mb-6 leading-[1.1] tracking-tight">
                <%= thread.title %>
            </h2>
            
            <div class="prose prose-invert max-w-none">
                <p class="text-slate-300 leading-relaxed text-lg font-medium whitespace-pre-wrap"><%= thread.content %></p>
            </div>
        </article>

        <section class="space-y-6">
            <div class="flex items-center gap-6 px-4 mb-10">
                <h3 class="shrink-0 text-[11px] font-black text-blue-500 uppercase tracking-[0.4em]">The Village Echoes</h3>
                <div class="h-[1px] w-full bg-gradient-to-r from-blue-500/20 to-transparent"></div>
            </div>

            <div class="space-y-4" id="repliesContainer">
                <% if (replies && replies.length > 0) { %>
                    <% replies.forEach(reply => { %>
                        <div class="reply-card ml-2 md:ml-12 p-6 rounded-2xl rounded-tl-none">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-9 h-9 rounded-xl overflow-hidden bg-slate-800 border border-white/5">
                                        <img src="<%= reply.author_pic || '/default-avatar.png' %>" class="w-full h-full object-cover">
                                    </div>
                                    <div>
                                        <p class="text-[12px] font-bold text-blue-400">@<%= reply.author_name %></p>
                                        <p class="text-[8px] text-slate-600 font-black uppercase tracking-widest">
                                            <%= new Date(reply.created_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) %>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <p class="text-slate-300 text-[15px] leading-relaxed pl-1">
                                <%= reply.reply_text %>
                            </p>
                        </div>
                    <% }) %>
                <% } else { %>
                    <div class="text-center py-16 bg-slate-900/10 rounded-[2.5rem] border border-dashed border-white/5">
                        <i class="fas fa-comment-slash text-3xl text-slate-800 mb-4"></i>
                        <p class="text-slate-600 font-black uppercase text-[10px] tracking-widest">Silence in the court. Be the first to chime in.</p>
                    </div>
                <% } %>
            </div>
        </section>

        <div class="fixed bottom-0 left-0 w-full p-4 md:p-6 bg-[#020617]/90 backdrop-blur-2xl border-t border-white/5 z-40">
            <div class="max-w-4xl mx-auto">
                <form action="/forum/thread/<%= thread.id %>/reply" method="POST" class="relative group">
                    <input type="text" name="reply_text" maxlength="500" id="replyInput"
                        placeholder="Speak your truth..." required 
                        class="w-full bg-white/5 border border-white/10 rounded-[1.5rem] pl-6 pr-32 py-5 text-sm text-white placeholder-slate-500 focus:outline-none focus:border-blue-500/50 focus:ring-4 focus:ring-blue-500/5 transition-all">
                    
                    <div class="absolute right-2 top-2 flex items-center gap-2">
                        <span id="charCount" class="hidden md:block text-[9px] font-black text-slate-600 mr-2 uppercase tracking-tighter">0 / 500</span>
                        <button type="submit" class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-3 rounded-xl font-black text-[10px] uppercase tracking-widest transition-all shadow-lg shadow-blue-600/20 active:scale-95">
                            Reply
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <script>
        // Character counter logic
        const input = document.getElementById('replyInput');
        const count = document.getElementById('charCount');

        input.addEventListener('input', () => {
            const length = input.value.length;
            count.innerText = `${length} / 500`;
            if (length > 450) {
                count.classList.replace('text-slate-600', 'text-red-500');
            } else {
                count.classList.replace('text-red-500', 'text-slate-600');
            }
        });

        // Scroll to bottom on load to see newest replies (Optional)
        // window.scrollTo(0, document.body.scrollHeight);
    </script>
</body>
</html>